# V2 版本变更日志 (Changelog)

本文档记录了 Novel Studio 从 V1 (基础创作版) 到 V2 (商业化运营版) 的主要变更。

## 1. 核心架构变更
- **新增经济系统**：引入“积分 (Credits)”概念，作为 AI 服务的消耗货币。
- **新增管理后台**：独立的 `/admin` 路由与布局，用于系统运维与用户管理。
- **安全升级**：注册流程引入 PoW (工作量证明) 人机验证与邮箱验证码机制。

## 2. 功能模块变更

### 2.1 认证与安全 (Auth)
- **[新增]** `CapJS` 组件：前端 PoW 计算，防止机器批量注册。
- **[新增]** 邮箱验证码流程：注册需先验证邮箱所有权。
- **[修改]** 注册接口：从直接注册改为 `send-code` + `register` 两步走。

### 2.2 用户中心 (User Center)
- **[新增]** 个人主页 (`/profile`)。
- **[新增]** 每日签到：随机积分奖励。
- **[新增]** 积分兑换：支持输入兑换码获取积分。
- **[新增]** 安全设置：修改密码功能。

### 2.3 AI 创作 (AI Workbench)
- **[新增]** `CopilotSidebar`：对话式 AI 助手，支持上下文感知。
- **[新增]** 计费逻辑：
  - 引入 `ModelConfig` (输入/输出倍率)。
  - 实时计算 Token 消耗并扣除积分。
  - 允许积分透支 (负数)，但透支后禁止新请求。
- **[新增]** 润色确认弹窗：用户在消耗积分前可预览 AI 修改结果。

### 2.4 后台管理 (Admin Panel)
- **[新增]** 仪表盘：监控用户增长、积分消耗、API 错误率。
- **[新增]** 模型管理：配置 LLM 模型倍率、启用/禁用模型。
- **[新增]** 用户管理：列表查看、封禁用户、**管理员手动调整积分**。
- **[新增]** 积分日志：全站积分流水审计。
- **[新增]** 兑换码管理：生成与状态追踪。
- **[新增]** 系统设置：配置签到奖励范围、注册开关、维护模式。

## 3. 数据结构变更 (Types)
- **User**: 增加 `credits` (number), `role` ('user'|'admin'), `lastCheckIn` (date), `isBanned` (boolean)。
- **ModelConfig**: 新增模型配置表。
- **CreditLog**: 新增积分流水表。
- **RedeemCode**: 新增兑换码表。
- **SystemSettings**: 扩充运营配置字段。

## 4. API 接口变更
| 模块 | 接口 | 说明 |
| :--- | :--- | :--- |
| **Auth** | `POST /api/v1/auth/send-code` | 发送验证码 (含 PoW 校验) |
| **User** | `POST /api/v1/user/check-in` | 每日签到 |
| **User** | `POST /api/v1/user/redeem` | 积分兑换 |
| **AI** | `POST /api/v1/ai/chat` | 对话 (含计费) |
| **AI** | `POST /api/v1/ai/refine` | 润色 (含计费) |
| **Admin** | `/api/v1/admin/*` | 全套管理接口 |