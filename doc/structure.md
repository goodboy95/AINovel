# 项目目录结构说明

- `frontend/`：React 18 + Vite 前端代码，包含页面、组件、样式与构建配置。
  - `src/pages/`：首页、登录注册、定价页、Dashboard（模块选择器）、小说/世界管理与编辑页等。
  - `src/pages/Profile/`：个人中心（积分、签到、兑换、修改密码）。
  - `src/pages/Admin/`：后台管理（仪表盘、模型管理、用户管理、积分日志、兑换码、系统设置）。
  - `src/pages/Admin/EmailManager.tsx`：SMTP 页面（查看 SMTP 状态、发送测试邮件）。
  - `src/components/ai/`：AI Copilot 侧边栏与润色弹窗等创作辅助组件。
  - `src/components/layout/`：用户端与后台端布局组件（含 AdminLayout）。
  - `src/contexts/AuthContext.tsx`：全局认证、角色与积分刷新逻辑。
  - `src/lib/mock-api.ts`：前端 API 适配层（封装对后端 `/api/v1/*` 的请求，保持页面调用接口不变）。
  - `src/lib/sso.ts`：统一登录（SSO）跳转 URL 构造（同源 `/sso/login`、`/register`）。
  - `src/pages/auth/Login.tsx`、`src/pages/auth/Register.tsx`：SSO 入口页（自动跳转到 userservice，并通过 `next` 参数保留回跳路径）。
  - `src/pages/auth/SsoCallback.tsx`：SSO 回跳处理页（从 hash 读取 `access_token` 并写入 LocalStorage）。
  - `package.json`：前端依赖与脚本配置（Vitest 现升级到 v4）。
  - `package-lock.json`：npm 依赖锁定文件。
  - `Dockerfile`、`nginx.conf`：前端构建与部署镜像配置（Nginx 静态资源 + `/api` 反向代理到 `127.0.0.1:20001`）。
- `backend/`：Spring Boot 3 后端代码（统一登录 token 鉴权），提供故事、素材、世界观、设置等 REST API。
  - `src/main/java/com/ainovel/app/`：入口与各业务模块（security、user、story、material、world、settings、manuscript）。
  - `src/main/java/com/ainovel/app/security/remote/UserSessionValidator.java`：可选的 userservice gRPC 会话校验（ValidateSession）。
  - `src/main/java/com/ainovel/app/user/SsoUserProvisioningService.java`：SSO 首次访问时按 userservice 的 `uid/username/role` 幂等创建/更新本地用户。
  - `src/main/java/com/ainovel/app/admin/`：后台管理接口（仪表盘、模型配置、用户管理、积分日志、兑换码、SMTP 测试）。
  - `src/main/java/com/ainovel/app/ai/`：AI Copilot 接口与 OpenAI 兼容客户端封装。
  - `src/main/java/com/ainovel/app/economy/`：积分、签到、兑换码与积分流水。
  - `src/main/resources/application.yml`：默认配置（可通过环境变量覆盖，包含 SMTP 与 AI 接入参数）。
  - `src/test/resources/mockito-extensions/org.mockito.plugins.MockMaker`：测试环境禁用 Mockito inline mock maker，避免 JDK 动态 attach 失败。
  - `src/test/java/com/ainovel/app/world/WorldPublishFlowTests.java`：世界观发布/生成流程的回归测试（模块进度与版本号）。
  - `Dockerfile`：后端构建与运行镜像配置。
- `sql/schema.sql`：数据库表结构参考脚本。
- `docker-compose.yml`：运行前后端容器的编排文件（前后端均使用 host 网络并监听 10001/20001 端口，显式容器名 `ainovel-frontend`/`ainovel-backend`），通过 volume 挂载前端 dist 与后端 jar，并注入 `JWT_SECRET`（与 userservice 一致）及 SMTP/AI 接入环境变量。
- `deploy/`：部署依赖服务与宿主机 Nginx 配置。
  - `docker-compose.yml`：运行依赖服务（MySQL/Redis）的编排文件（容器名 `ainovel-mysql`/`ainovel-redis`），对外开放 3308/6381 端口并持久化数据到 deploy 目录。
  - `build.sh`：依赖服务容器的启动/重启脚本（docker compose down/up，固定项目名 `ainovel-deps`）。
  - `nginx/ainovel.conf`：宿主机 Nginx 反向代理配置，将 `ainovel.seekerhut.com` 指向前端 10001 端口。
  - `nginx/ainovel_prod.conf`：生产域名 `ainovel.aienie.com` 的 HTTP 反向代理模板（由 build_prod.sh 结合 Certbot 切换到 HTTPS）。
- `build.sh`：在宿主机完成前后端构建与测试，将后端 Jar、前端 dist 产物映射到容器后启动服务（root 环境下使用 runuser/su 切回原用户，避免非交互 sudo 卡住）。
- `build_prod.sh`：生产部署脚本（调用 build.sh，支持 --init 时申请证书并配置 `ainovel.aienie.com` HTTPS）。
- `doc/api/`：各 Controller 对应的接口说明文档。
  - `admin.md`：后台管理接口（仪表盘/模型/用户/日志/兑换码/SMTP）。
  - `ai.md`：AI Copilot 相关接口（模型列表/对话/润色）。
  - `material.md`：素材上传/审核/检索接口说明。
  - `manuscript.md`：稿件生成/保存/角色变化分析接口说明。
  - `settings.md`：模型配置与提示词设置接口说明。
  - `story.md`：故事与大纲相关接口说明。
  - `user.md`：个人资料、签到、兑换码、修改密码接口说明。
  - `world.md`：世界观与定义接口说明。
- `doc/modules/`：功能模块说明。
- `doc/issues.md`：开发/测试过程中记录的待处理问题与已解决事项。
- `doc/test/`：测试用例与操作步骤文档。
- `AGENTS.md`：任务与交付规范。
