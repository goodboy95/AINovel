# 响应式改造 Step 3 —— 故事构思与故事管理模块

## 1. 背景与目标

在完成工作台框架调整后，需要继续推进核心创作流程中的两个模块：故事构思（Story Conception）与故事管理（Story Management）。这两个模块均包含大量表单、列表以及生成结果卡片，桌面端使用多列排版，在移动端几乎无法阅读。本阶段目标是重构信息架构，使其在手机与平板上按照任务流程呈现，同时保持桌面端的高效率。

### 1.1 目标拆解

- 故事构思：将左右双列表单/结果改为纵向步骤式布局，提供移动端折叠与抽屉交互。
- 故事管理：重构故事列表、详情与角色面板，支持移动端 Drawer 切换，角色信息可折叠展示。
- 统一角色卡片、表单间距、生成结果区域的响应式样式，为后续模块复用。
- 确保改造后数据流（创建、编辑、保存、生成等）保持稳定，状态在不同视图间同步。

## 2. 范围界定

| 模块 | 主要文件 | 改造要点 |
| --- | --- | --- |
| 故事构思 | `components/StoryConception.tsx`、`components/StoryIdeaForm.tsx`、`components/StoryIdeaResult.tsx` | 表单/结果布局改造、移动端折叠、角色管理入口 |
| 角色管理（构思内） | `components/CharacterCard.tsx`、`components/CharacterList.tsx` | 卡片组件响应式、移动端抽屉编辑 |
| 故事管理 | `components/StoryList.tsx`、`components/StoryDetail.tsx`、`components/StoryFormModal.tsx` | 列表 Drawer 化、详情信息分区、角色列表折叠 |
| 公共组件 | `components/common/ResponsiveCard.tsx` *(新增)*、`components/common/ResponsiveStack.tsx` *(新增)* | 抽象卡片外观与 Stack 间距 |

## 3. 体验设计

### 3.1 故事构思流程

1. **桌面端 (`lg` 及以上)**
   - 保留双列布局，但通过 `min-width` 控制列宽，防止过度压缩。
   - 结果区支持固定滚动容器，顶部展示生成历史标签。
2. **移动端 (`xs/sm`)**
   - 使用步骤式布局：
     1. 故事信息表单
     2. 角色设定（列表 + Drawer 编辑）
     3. 生成结果展示
   - 每个步骤使用 `Collapse`/`Steps` 呈现，默认展开当前步骤，其余折叠。
   - 生成按钮放置在底部 `PrimaryActionBar` 中，确保操作一致。
3. **平板 (`md`)**
   - 允许表单与结果并列，但宽度比例改为 5:7，确保可视性。

### 3.2 故事管理体验

- **故事列表**
  - 桌面端保持左侧列表 + 右侧详情结构，但列表宽度在 280-320px 之间自适应。
  - 移动端列表收纳到 `Drawer`，支持搜索与筛选；点击后自动关闭 Drawer，跳转到详情顶部。
- **详情页信息层级**
  - 顶部展示故事基本信息（标题、类型、最近更新时间），在移动端使用卡片式布局。
  - 角色、设定、章节等信息模块使用 `ResponsiveCard` + `Collapse`，可展开查看。
  - 操作按钮（新增角色、编辑故事）在移动端移至底部操作栏或顶部工具条。
- **角色列表**
  - 使用 `ResponsiveStack` 控制间距，手机上单列、平板双列、桌面三列。
  - 角色详情编辑在移动端使用 Drawer 或全屏 Modal。

## 4. 技术方案

### 4.1 布局组件

- `ResponsiveCard`
  - props：`title`、`extra`、`padding`、`collapseOnMobile`。
  - 移动端启用 `collapseOnMobile` 时，默认折叠，仅展示标题。
- `ResponsiveStack`
  - 基于 `Flex` 封装，接受 `direction`、`gap`、`wrap`、`breakpoints` 配置，可在不同断点切换方向与间距。

### 4.2 故事构思实现

1. **表单区域**
   - 使用 `ResponsiveStack` 在 `lg` 以上保持两列，`md` 以下改为单列。
   - 关键输入项（如题材、故事背景）提供字符计数，移动端使用 `textarea` 自适应高度。
2. **角色管理**
   - `CharacterList` 在移动端仅展示角色摘要，点击进入 Drawer 查看详情与编辑。
   - Drawer 内表单复用 Step 1 中的 `Form` 样式，提供保存/取消按钮，底部留白适配安全区。
3. **结果展示**
   - 结果卡片使用 `ResponsiveCard`，在移动端支持左右滑动查看生成历史。
   - 提供「复制」「收藏」操作，按钮集中于卡片底部，采用图标 + 文本。

### 4.3 故事管理实现

1. **故事列表**
   - 引入 `useResponsive` 判断是否使用 Drawer；在桌面端仍渲染侧边栏，移动端渲染触发按钮。
   - 列表项采用 `ResponsiveCard` 的紧凑版，移动端显示标题、副标题、更新时间。
2. **详情面板**
   - 按模块拆分：基本信息、世界观设定、角色、章节、标签等。
   - 每个模块使用 `ResponsiveCard` 包裹，支持折叠，折叠状态持久化至本地存储。
3. **角色卡片**
   - 采用 `ResponsiveStack` 控制列数，在 `lg` 为三列、`md` 为两列、`xs` 为单列。
   - 卡片内部按钮在移动端改为圆角按钮或图标按钮，避免占用空间。

### 4.4 数据与状态

- 确认现有 API/Store 是否支持懒加载，避免移动端 Drawer 打开时重新请求。
- Drawer 关闭后应保留编辑中的草稿，必要时使用局部状态或 `useRef`。
- 生成结果历史需确保在切换断点时不会重复生成或丢失数据，可将结果存储在模块级 state 中。

## 5. 实施步骤与排期建议

1. **设计确认 (0.5 人日)**：与设计师对齐移动端线框，特别是步骤流程与折叠交互。
2. **公共组件开发 (0.5 人日)**：实现 `ResponsiveCard`、`ResponsiveStack` 并写好示例。
3. **故事构思改造 (1.5 人日)**：
   - 重构表单与结果布局。
   - 实现角色 Drawer、生成历史滑动。
4. **故事管理改造 (1.5 人日)**：
   - 列表 Drawer 化与详情模块化。
   - 角色卡片响应式。
5. **联调与测试 (0.5 人日)**：覆盖接口、状态同步、动效与滚动问题。

## 6. 风险与应对

| 风险 | 描述 | 缓解措施 |
| --- | --- | --- |
| Drawer/Collapse 状态混乱 | 多处折叠可能导致用户迷失或状态错误 | 使用受控组件，状态存储在模块级别，必要时同步至 URL 或本地存储 |
| 角色编辑冲突 | 多个 Drawer 同时打开导致状态覆盖 | 限制同一时间仅打开一个 Drawer，或在打开新 Drawer 时确认保存 |
| 移动端滚动性能 | 长列表 + 卡片可能导致性能问题 | 复用虚拟滚动或按需加载；控制图片/插画加载大小 |

## 7. 验收标准与测试计划

1. **功能验收**
   - 故事构思流程在手机上可完整完成：填写表单 → 管理角色 → 生成结果。
   - 故事管理在手机上可切换故事、查看详情、编辑角色，无页面跳转问题。
   - 折叠/Drawer 状态在切换断点后保持合理（可重置，也可按需求保留）。
2. **测试清单**
   - 单元测试：`ResponsiveCard` 折叠逻辑、`ResponsiveStack` 在不同断点下的排列。
   - 集成测试：模拟创建/编辑故事流程，验证状态同步与 API 调用次数。
   - 手动测试：真机验证列表滚动、Drawer 弹出、键盘弹起后的布局。

完成 Step 3 后，创作流程中前两个模块具备良好的移动端体验，可继续进行大纲与正文相关的改造。
