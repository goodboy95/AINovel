# 操作步骤（端到端）

1. **统一登录（SSO）**
   - 打开前端（开发/测试域名）`http://ainovel.seekerhut.com/`；生产域名 `https://ainovel.aienie.com/`（部署后）。
   - 登录：点击页面上的“登录”按钮会直接跳转到同域名的 `/sso/login`（由宿主机 Nginx 反代到 userservice）；也可直接访问 `/login`（会自动跳转）。
   - 注册：点击页面上的“注册/免费开始”按钮会直接跳转到同域名的 `/register`（由宿主机 Nginx 反代到 userservice）；也可直接访问 `/register`（会自动跳转）。
   - 登录/注册成功后会回跳到 `/sso/callback`，前端从 URL hash 读取 `access_token` 并写入 LocalStorage。
   - 管理员权限：由 userservice 下发的 token 里 `role=ADMIN` 决定（AINovel 后端据此映射为 `ROLE_ADMIN`）。

2. **个人中心（积分/签到/兑换）**
   - 进入 `/profile`，确认头像、邮箱与积分余额展示。
   - 点击“每日签到”，成功后余额增加、按钮禁用显示“今日已签到”。
   - 输入兑换码（例如 `VIP888` / `WELCOME2026` / `TOPUP100`）点击“兑换”，余额增加，输入框清空。
   - 密码管理：由统一登录服务负责，本系统不提供改密功能（`POST /api/v1/user/password` 固定返回 501）。

3. **后台管理（管理员账号）**
   - 进入 `/admin/dashboard` 查看仪表盘指标。
   - 进入 `/admin/models` 调整模型倍率、启用状态。
   - 进入 `/admin/users` 查看用户列表、封禁/解封、发放积分。
   - 进入 `/admin/logs` 查看积分日志记录。
   - 进入 `/admin/codes` 创建/查看兑换码状态。
   - 进入 `/admin/email` 查看 SMTP 状态、发送测试邮件。
   - 进入 `/admin/settings`：
     - 开关注册/维护模式、签到积分区间。
     - 配置 **LLM 全局参数**（Base URL/Model/API Key）与 **SMTP 全局参数**（Host/Port/Username/Password）。
       - 参数来源：`SMTPandLLM.txt`（只在后台界面填写，不要写入代码或配置文件）。

4. **故事与大纲**
   - 从 `/dashboard` 进入 `/novels`，点击“新建小说”进入 `/novels/create` 创建小说。
   - 进入 `/workbench?id=...`：
     - “故事管理”可查看并新增角色。
     - “大纲编排”中新建大纲/章节/场景并保存。

5. **稿件与 AI Copilot**
   - 工作台 → “小说创作”：
     - 选择故事/大纲/稿件 → 选择场景 → 编辑正文（自动保存 + 手动保存）。
     - 点击“生成本场景”触发占位生成。
   - 打开右侧 AI Copilot，选择模型并发送消息；积分会随调用产生变化并写入日志。
   - 编辑器选中文本 → 气泡菜单“润色”，会调用 AI 并产生积分扣减。

6. **素材库**
   - 页面 `/materials`：在“创建素材”填写标题/正文/标签提交；列表自动刷新。
   - “上传文件”选择 TXT → 开始上传 → 轮询状态完成后，待审列表会出现该素材；在“素材审核”中批准或驳回。
   - 列表中可编辑/删除素材，查重合并、查看引用历史（当前为空）。
   - 工作台“素材检索”标签可直接搜索同一后端的素材。

7. **世界构建**
   - 从 `/dashboard` 进入 `/worlds`，点击“新建世界”进入 `/worlds/create` 创建世界草稿。
   - 进入 `/world-editor?id=...`：
     - 编辑元信息与模块字段，点击“保存”持久化。
     - 点击“预检/发布”可触发生成并更新模块内容（示例生成逻辑）。

8. **设置与提示词**
   - 页面 `/settings`：可查看/覆盖个人的模型接入参数（可选，默认使用管理员配置的全局 LLM）。
   - “工作区提示词”/“世界观提示词”标签可编辑并保存模板；帮助按钮跳转至提示词帮助页查看变量/函数说明。

9. **登出**
   - 头部用户菜单选择退出，或清除浏览器 LocalStorage 中的 `token`。

10. **后端接口连通性（可选）**
   - 未登录时访问 `/api/v1/user/profile` 应返回 403；完成统一登录后再次访问应返回 200（包含 `id/username/role/credits` 等）。
