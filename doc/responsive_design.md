# 响应式布局设计与开发方案

## 1. 背景与目标
AI 小说家前端目前主要围绕 PC 端设计，版面由 Ant Design 的 `Layout`、`Row/Col`、以及少量 Tailwind Utility 类组成，辅以大量内联样式。现有实现存在以下问题：

- `#root` 在 `App.css` 中被限制为 1280px 且居中，导致宽屏下留白严重，小屏下出现横向滚动。
- `Workbench` 内部的多列布局（故事管理、大纲工作台、小说创作）在窄屏下不可读，未针对移动端做切换。
- 认证页与首页仍然按照桌面尺寸固定卡片宽度，移动端体验较差。

本次工作目标是：

1. 为所有前端页面（首页、登录注册、工作台及其子模块、模态窗口）提供一致的响应式体验。
2. PC 端沿用既有布局，但需在 1280px、1440px、1600px 等常见宽度下自动伸缩，不再依赖固定像素；
3. 移动端（手机视角）需要重新设计信息层级与交互流程，提供单列排布、抽屉/底部弹层等适配方案。
4. 在保持功能完整的前提下，尽量复用现有组件逻辑，减少对业务代码的侵入式改动。

## 2. 现状评估

| 模块 | 当前实现概述 | 响应式痛点 |
| --- | --- | --- |
| 全局结构 | `App.tsx` 直接渲染路由组件，根节点样式位于 `App.css`，Tailwind 仅加载基础层 | 根容器宽度固定、字体/间距未做断点区分 |
| 首页 `HomePage` | Tailwind Flex 居中，标题 5xl | 字体过大，按钮排布在窄屏下换行但缺少边距 |
| 登录/注册 | 使用 Antd `Card` 固定宽度 400px | 手机端无法完整显示表单，需要横向滚动 |
| 工作台 `Workbench` | 上方 Header + Tabs，内部大量 `Row/Col` 和 Card 布局 | Tabs、Card 过于拥挤，Row 在窄屏仍保持多列，交互按钮难触达 |
| 故事构思 `StoryConception` | 左列表单、右列结果 | 小屏下左右并排导致压缩严重 |
| 故事管理 | 左列表、右详情 + 角色卡片 | 移动端需要折叠式切换；角色卡片仍以双列排布 |
| 大纲工作台 | 三列布局（故事选择、树、编辑器） | 小屏几乎无法阅读，需要纵向分步展现 |
| 小说创作 | 三列：大纲树、正文、角色侧边栏 | 手机端无法同时展示，需要切换视图 |
| 各类模态框 | 使用默认宽度 | 移动端占屏不足/遮挡严重 |

## 3. 响应式策略总览

### 3.1 断点规划

综合 Ant Design 默认断点与产品需求，统一如下：

| 名称 | 像素范围 | 设备定位 | 说明 |
| --- | --- | --- | --- |
| `xs` | `< 576` | 手机 | 采用独立移动端布局与交互 |
| `sm` | `576 - 767` | 大屏手机/小平板 | 延续移动端布局，增加局部双列可能性 |
| `md` | `768 - 991` | 平板/小屏笔记本 | 介于手机与桌面之间，部分模块切换为两列 |
| `lg` | `992 - 1439` | 主流 PC | 保留现有布局，依据宽度动态调整间距/高度 |
| `xl` | `>= 1440` | 宽屏 PC | 加宽内容容器、提高卡片最大宽度 |

Tailwind 将扩展对应断点，Antd `Grid.useBreakpoint()` 结合自定义 `useResponsive()` Hook，用于在组件内切换布局/逻辑。

### 3.2 技术手段

- **样式体系**：继续使用 Tailwind Utility 负责移动端快速排版，同时新增 `src/styles/responsive.css` 编写公共媒体查询（用于内联样式迁移部分）。
- **栅格与布局**：保留 Antd `Row/Col`，补充 `xs`/`sm`/`md` 配置；对复杂场景引入自定义 `Stack` 布局（基于 Flex）。
- **交互容器**：移动端大量使用 `Drawer`、`Collapse`、`Tabs`/`Segmented`，以减小屏幕占用；PC 端继续使用 `Layout`。
- **逻辑判定**：新增 `hooks/useResponsive.ts`，封装 `Grid.useBreakpoint()`，提供 `isMobile`、`isTablet`、`isDesktop` 等布尔值，供组件选择渲染。

## 4. PC 端布局调整

1. **全局容器**：
   - 删除 `App.css` 中的 `#root` 限制，改由 `body` 设置背景色、`min-height`，在 `Content` 上设置 `max-width: 1440px` 并居中。
   - `Workbench` 内容区 `padding` 在 `lg` 时保持 24px，在 `md` 时降为 16px。

2. **导航与头部**：
   - `WorkbenchHeader` 保持左右结构，但在 `lg` 以下缩小标题字号，`xs` 隐藏 Logo 文案，仅保留图标；用户菜单改为 Icon Button。

3. **模块间距**：
   - 所有 `Card` 统一 `borderRadius`、`boxShadow`，`lg` 以上拉大 `gutter` 至 24px，`md` 以下压缩为 16px，`xs` 为 12px。

4. **特定模块**：
   - `OutlinePage`、`ManuscriptWriter` 中的多列布局在 `lg` 以上仍为 3 列，但使用 `flex: 1` + `minWidth` 控制宽度，以适应 1280/1440 宽度。
   - PC 平台新增“内容区域高度自适应”，避免 `height: 100%` 固定导致溢出，改为 `min-height` + `overflow: auto`。

## 5. 移动端重新设计

### 5.1 导航与交互
- `Workbench` 顶部新增移动端导航条：左侧为返回首页按钮，中间使用 `Tabs` 或 `Segmented` 紧凑展示三个主功能；右侧保留用户菜单图标。
- 将故事列表、角色侧栏等辅助信息改为按钮触发的 `Drawer`，默认折叠。
- 主要操作（新增、保存、生成）在移动端使用底部固定操作栏或悬浮按钮，确保易触达。

### 5.2 首页与认证流程
- 首页标题字号缩减到 `text-3xl`，引导文案宽度设为 `max-w-md`，按钮改为 100% 宽度堆叠。
- 登录/注册页使用全屏容器 + 自适应 `Card`：`width: min(100%, 360px)`，表单项间距缩短，辅助链接置于卡片底部居中。

### 5.3 工作台主界面
- Tabs 改为 `tabBarGutter={8}`、`size="small"`，移动端使用 `tabPosition="top"` 并开启滑动；必要时替换为自定义 `Segmented`。
- 内容区改为纵向滚动，模块之间使用 `space-y-4`。

### 5.4 故事构思
- 表单与结果采用上下排列：表单置顶，结果区折叠显示。角色卡片使用单列列表，每张卡片内容折叠（`Collapse`）。
- “添加新角色”在移动端改为底部固定按钮，同时在结果区域顶部提供按钮入口。

### 5.5 故事管理
- 故事列表移动到 `Drawer`：顶部提供“选择故事”按钮；在 Drawer 内仍使用 `List`，点击后 Drawer 关闭。
- 详情页顶端显示当前故事基本信息与快捷操作按钮，角色区域使用 `Collapse` 每个角色折叠。
- 新建故事流程移动端以分步表单呈现（使用 `Steps` 或顶部标签）。

### 5.6 大纲工作台
- 将三列内容拆为三个 `Collapse.Panel`：
  1. **故事与大纲选择**：顶部常驻，放入折叠面板；
  2. **大纲结构**：面板内展示 `OutlineTreeView`，支持折叠章节、内嵌搜索；
  3. **生成/编辑区域**：在选中节点后展开详细编辑。
- “保存大纲”按钮改为固定在页面底部（移动端），确保随时可点。

### 5.7 小说创作
- 将三列切换成移动端 `Tabs`：
  - Tab1：大纲结构（含选择故事/大纲按钮）；
  - Tab2：正文编辑器；
  - Tab3：角色状态。
- 编辑器顶部保留场景信息卡片，底部放置“生成/保存”按钮；角色侧栏内容改为列表卡片，可折叠。

### 5.8 模态与弹窗
- 所有自定义 `Modal` 增加 `fullScreen` 支持：移动端下 `width='100%'`、`top=0`。
- 角色详情、AI 打磨等弹窗在移动端切换为 `Drawer`。

## 6. 组件改造清单与要点

| 模块 | 影响文件 | 改造要点 |
| --- | --- | --- |
| 全局样式 | `src/index.css`, `App.css` | 移除旧有 Vite Demo 样式，新增全局变量、媒体查询、字体设置；引入 `responsive.css` |
| Tailwind | `tailwind.config.js` | 扩展自定义 `screens`，增加颜色/间距变量（如 `spacing.18`） |
| 响应式 Hook | `src/hooks/useResponsive.ts` *(新增)* | 包装 `Grid.useBreakpoint()`，提供统一布尔值 & 当前断点名称 |
| App 入口 | `App.tsx`, `main.tsx` | 根容器新增 `.app-shell` 包裹，统一背景与最大宽度控制 |
| 首页 | `components/HomePage.tsx` | 引入 `useResponsive` 调整字号/按钮布局；Tailwind 响应式类 |
| 登录/注册 | `components/Login.tsx`, `Register.tsx` | 改成 `className` + 媒体查询，Card 宽度动态；表单间距与辅助链接位置调整 |
| 工作台头部 | `components/WorkbenchHeader.tsx` | 根据断点切换标题/按钮展示；移动端加入抽屉触发按钮 |
| 工作台容器 | `components/Workbench.tsx` | 统一内容 `padding`；Tabs 在移动端改为自定义导航；在 `isMobile` 时隐藏部分侧栏，改用 Drawer 组件 |
| 故事构思 | `components/StoryConception.tsx` | `Row/Col` 添加 `xs`, `md`, `lg` 配置；移动端角色区域使用 `Collapse`；新增顶部工具栏 |
| 故事列表/详情 | `StoryList.tsx`, `StoryDetail.tsx` | 列表支持 Drawer；详情表单控件改用 `Flex` 布局；角色卡片在移动端 Stack 排布 |
| 大纲工作台 | `OutlinePage.tsx`, `OutlineTreeView.tsx`, `ChapterEditForm.tsx`, `SceneEditForm.tsx` | 重构布局为 `Collapse` + Tabs；按钮位置、表单宽度响应式调整；树视图增设搜索栏/滚动区域限制 |
| 小说创作 | `ManuscriptWriter.tsx`, `CharacterStatusSidebar.tsx`, `modals/*` | 引入移动端 Tabs；角色侧栏改造为列表组件；按钮组移动到底部固定区域；Drawer 管理角色/图谱/对话弹窗 |
| 其他 | `modals/*.tsx` | 对齐 `Modal` 的 `styles`, `bodyStyle`，根据断点设置 `width`、`height` |

## 7. 开发步骤与里程碑

1. **准备阶段**
   - 清理/调整全局样式、Tailwind 断点。
   - 新增 `useResponsive` Hook 与公共布局组件（如 `AppShell`）。

2. **基础页面适配**
   - 首页、登录、注册页面响应式；验证导航跳转正常。

3. **工作台框架调整**
   - 改造 `Workbench` Tabs 与 Header。
   - 实现移动端 Drawer 导航（故事列表、设置面板）。

4. **故事构思与管理模块**
   - 表单与预览布局切换；角色卡片响应式排布。
   - 新建/编辑流程在移动端的多步体验。

5. **大纲工作台**
   - 引入 `Collapse` + 底部操作栏。
   - 节点编辑表单的宽度/按钮适配。

6. **小说创作模块**
   - Tab 化布局；角色状态改为列表。
   - 调整 AI 打磨、关系图谱等弹窗在移动端的呈现。

7. **联调与视觉校准**
   - 检查 375px、414px、768px、1024px、1280px、1440px、1920px 下的表现。
   - 与产品确认移动端操作流程。

8. **测试与文档**
   - 编写更新日志、在 README/开发手册中补充响应式说明。

## 8. 测试计划

- **自动化**：`npm run lint`、`npm run test`（若有）、`npm run build`，确保构建无误。
- **手动测试矩阵**：
  - 浏览器：Chrome、Edge、Safari（移动端可通过设备模拟器）。
  - 断点：375、414、768、992、1280、1440、1600。
  - 功能：登录、故事创建/删除、角色新增、生成/保存大纲、小说生成/保存、角色分析弹窗。
- **无障碍**：检查移动端触控区域（按钮高度>=44px）、键盘导航、颜色对比度。

## 9. 风险与应对

| 风险 | 影响 | 应对 |
| --- | --- | --- |
| 大量内联样式难以覆盖 | 移动端样式凌乱 | 抽取关键样式到 CSS/Tailwind，逐步替换内联样式 |
| Drawer/Collapse 切换导致状态同步复杂 | 用户切换视图时数据丢失 | 将核心状态继续保存在父组件（保持现有 hooks），仅改变展示层 |
| Antd Tabs 在移动端滚动表现欠佳 | Tab 无法全部展示 | 在移动端改用 `Segmented` + `Dropdown` 组合，自定义导航 |
| 模态过多导致移动端性能问题 | 卡顿、动画不流畅 | 对大型弹窗启用 `destroyOnClose`，减少 DOM 保留 |

## 10. 验收标准

- 不同尺寸下无水平滚动条，主要内容在首屏可见且操作按钮触手可及。
- 功能路径在移动端保持完整可达（故事创建→大纲生成→小说撰写→角色分析）。
- 视觉符合设计规范：统一的间距、字体、按钮样式。
- QA 验证手动测试矩阵全部通过，构建产物通过流水线检查。

